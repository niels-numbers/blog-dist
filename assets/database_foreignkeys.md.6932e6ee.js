import{_ as s,c as n,o as e,a}from"./app.74c48566.js";const g=JSON.parse('{"title":"Foreign Keys in Laravel","description":"","frontmatter":{},"headers":[{"level":2,"title":"Modern Syntax","slug":"modern-syntax","link":"#modern-syntax","children":[]},{"level":2,"title":"Legacy Setup (for integer IDs)","slug":"legacy-setup-for-integer-ids","link":"#legacy-setup-for-integer-ids","children":[]},{"level":2,"title":"foreignId() vs foreign()","slug":"foreignid-vs-foreign","link":"#foreignid-vs-foreign","children":[]}],"relativePath":"database/foreignkeys.md"}'),o={name:"database/foreignkeys.md"},l=a(`<h1 id="foreign-keys-in-laravel" tabindex="-1">Foreign Keys in Laravel <a class="header-anchor" href="#foreign-keys-in-laravel" aria-hidden="true">#</a></h1><h2 id="modern-syntax" tabindex="-1">Modern Syntax <a class="header-anchor" href="#modern-syntax" aria-hidden="true">#</a></h2><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><ul><li>Creates <code>unsignedBigInteger(&#39;user_id&#39;)</code></li><li>Adds foreign key to table <code>users</code> on column <code>id</code> (name conventions).</li></ul><p>With cascade:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnUpdate</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or $table-&gt;restrictOnUpdate();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnDelete</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or -&gt;nullOnDelete() / -&gt;restrictOnDelete()</span></span>
<span class="line"></span></code></pre></div><p>Custom table/index:</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">posts_user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>If you want to make the foreign key nullable, this has to be declared before the constrained method.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreignId</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">nullable</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// Make sure to call this before constrained https://github.com/laravel/framework/issues/32460 </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">constrained</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnUpdate</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or $table-&gt;restrictOnUpdate();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnDelete</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or -&gt;nullOnDelete() / -&gt;restrictOnDelete()</span></span>
<span class="line"></span></code></pre></div><h2 id="legacy-setup-for-integer-ids" tabindex="-1">Legacy Setup (for <code>integer</code> IDs) <a class="header-anchor" href="#legacy-setup-for-integer-ids" aria-hidden="true">#</a></h2><p>In older Laravel apps, <code>$table-&gt;id()</code> created an unsigned <code>integer</code> instead of <code>bigInteger</code>.<br> Because <code>foreignId()</code> always creates an <code>unsignedBigInteger</code>, it will <strong>not match</strong> in this case, and cause foreign key errors.</p><p>You must either:</p><ol><li>Update the referenced column to <code>bigIncrements</code>, or</li><li>Define the foreing key manually like this:</li></ol><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">integer</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)-&gt;</span><span style="color:#82AAFF;">unsigned</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">foreign</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">references</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// constrained() does not work for foreign()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">on</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnUpdate</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or $table-&gt;restrictOnUpdate();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">cascadeOnDelete</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;">// or -&gt;nullOnDelete() / -&gt;restrictOnDelete()</span></span>
<span class="line"></span></code></pre></div><h2 id="foreignid-vs-foreign" tabindex="-1"><code>foreignId()</code> vs <code>foreign()</code> <a class="header-anchor" href="#foreignid-vs-foreign" aria-hidden="true">#</a></h2><p><strong>foreignId()</strong></p><ul><li>Returns <code>Illuminate\\Support\\Fluent</code></li><li>Supports <code>-&gt;constrained()</code></li><li>Also supports <code>-&gt;references()</code> and <code>-&gt;on()</code></li><li>Creates the column <em>and</em> foreign key in one step</li></ul><p><strong>foreign()</strong></p><ul><li>Returns <code>Illuminate\\Database\\Schema\\ForeignKeyDefinition</code></li><li>Does <strong>not</strong> support <code>-&gt;constrained()</code></li><li>Requires existing column</li><li>Supports <code>-&gt;references()</code> and <code>-&gt;on()</code> like <code>foreignId()</code></li></ul><blockquote><p>\u{1F4A1} Use <code>foreignId()</code> when your related table uses <code>bigIncrements</code>.<br> For legacy tables with <code>int</code> primary keys, use <code>foreign()</code> instead.</p></blockquote><p>\u{1F449} <a href="https://laravel.com/docs/12.x/migrations#foreign-key-constraints" target="_blank" rel="noreferrer">Laravel Docs</a></p>`,22),p=[l];function t(r,c,i,D,F,d){return e(),n("div",null,p)}const A=s(o,[["render",t]]);export{g as __pageData,A as default};
